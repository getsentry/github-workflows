# This isn't a reusable workflow but an actual CI action for this repo itself - to test the workflows.
name: Danger Workflow Tests

on:
  pull_request:
    types: [opened, synchronize, reopened, edited, ready_for_review]

permissions:
  contents: read
  pull-requests: write

jobs:
  # Test Danger action on pull requests - should analyze PR and report findings
  test-danger-pr-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Run danger action
        id: danger
        uses: ${{ github.repository }}/danger@${{ github.sha }}

      - name: Validate danger outputs
        env:
          DANGER_OUTCOME: ${{ steps.danger.outputs.outcome }}
        run: |
          echo "üîç Validating Danger action outputs..."
          echo "Danger Outcome: '$DANGER_OUTCOME'"

          # Validate that Danger ran successfully
          if [[ "$DANGER_OUTCOME" != "success" ]]; then
            echo "‚ùå Expected Danger outcome 'success', got '$DANGER_OUTCOME'"
            echo "This could indicate:"
            echo "  - Danger found issues that caused it to fail"
            echo "  - The action itself encountered an error"
            echo "  - Docker container issues"
            exit 1
          fi

          echo "‚úÖ Danger PR analysis completed successfully!"
          echo "‚ÑπÔ∏è  Check the PR comments for any Danger findings"
